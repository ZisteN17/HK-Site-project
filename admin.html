<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админка — ХК КГАСУ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #f5f5f5; padding: 2rem; }
        h1 { text-align: center; margin-bottom: 0.5rem; }
        .subtitle { text-align: center; color: #666; margin-bottom: 2rem; }
        .games-list { max-width: 700px; margin: 0 auto; }

        .game-row {
            background: white;
            border-radius: 10px;
            padding: 1.2rem 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .game-row.played { opacity: 0.5; }
        .game-row.played:hover { opacity: 1; }
        .game-date { font-size: 0.85rem; color: #666; min-width: 140px; }
        .game-teams { font-weight: 600; flex: 1; min-width: 200px; }
        .game-teams .vs { color: #DC143C; margin: 0 0.3rem; }
        .score-inputs { display: flex; align-items: center; gap: 0.3rem; }
        .score-inputs input {
            width: 45px; height: 36px;
            text-align: center; font-size: 1.1rem; font-weight: 700;
            border: 2px solid #ddd; border-radius: 6px;
            outline: none;
        }
        .score-inputs input:focus { border-color: #DC143C; }
        .score-inputs span { font-weight: 700; color: #333; }
        .status-badge {
            font-size: 0.75rem; padding: 0.2rem 0.6rem;
            border-radius: 20px; font-weight: 600;
        }
        .status-badge.future { background: #e3f2fd; color: #1976d2; }
        .status-badge.played-badge { background: #e8f5e9; color: #388e3c; }

        .actions { text-align: center; margin-top: 2rem; }
        .btn {
            padding: 0.8rem 2rem; font-size: 1.1rem; font-weight: 600;
            border: none; border-radius: 8px; cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary { background: #DC143C; color: white; margin-right: 1rem; }
        .btn-primary:hover { background: #a01029; }
        .btn-secondary { background: #333; color: white; }
        .btn-secondary:hover { background: #555; }

        .toast {
            position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%);
            background: #333; color: white; padding: 1rem 2rem;
            border-radius: 8px; font-weight: 600; display: none;
            z-index: 100;
        }
        .toast.show { display: block; animation: fadeInUp 0.3s; }

        .instructions {
            max-width: 700px; margin: 2rem auto 0;
            background: #fff3cd; border-radius: 10px; padding: 1.5rem;
            font-size: 0.95rem; line-height: 1.6;
        }
        .instructions h3 { margin-bottom: 0.5rem; }
        .instructions ol { padding-left: 1.5rem; }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translate(-50%, 10px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }
    </style>
</head>
<body>
    <h1>Управление расписанием ХК КГАСУ</h1>
    <p class="subtitle">Введите счёт после матча и нажмите «Сохранить»</p>

    <div class="games-list" id="gamesList"></div>

    <div class="actions">
        <button class="btn btn-primary" onclick="copyUpdatedFile()">Скопировать обновлённый файл</button>
    </div>

    <div class="instructions">
        <h3>Как обновить сайт после матча:</h3>
        <ol>
            <li>Найдите нужный матч в списке выше</li>
            <li>Введите счёт в два поля (хозяева — гости)</li>
            <li>Нажмите <strong>«Скопировать обновлённый файл»</strong></li>
            <li>Откройте файл <code>js/schedule.js</code> в любом текстовом редакторе</li>
            <li>Выделите всё (Ctrl+A), вставьте скопированное (Ctrl+V), сохраните</li>
            <li>Закоммитьте и запушьте изменения в GitHub</li>
        </ol>
    </div>

    <div class="toast" id="toast"></div>

    <script src="js/schedule.js"></script>
    <script>
        const months = [
            'января', 'февраля', 'марта', 'апреля', 'мая', 'июня',
            'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'
        ];

        function formatDate(dateStr) {
            const d = new Date(dateStr);
            return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}, ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
        }

        function renderGames() {
            const list = document.getElementById('gamesList');
            list.innerHTML = '';

            KGASU_GAMES.forEach((game, i) => {
                const isPlayed = game.homeScore !== null;
                const row = document.createElement('div');
                row.className = 'game-row' + (isPlayed ? ' played' : '');
                row.innerHTML = `
                    <span class="game-date">${formatDate(game.date)}</span>
                    <span class="game-teams">${game.home} <span class="vs">VS</span> ${game.away}</span>
                    <div class="score-inputs">
                        <input type="number" min="0" max="99" id="home-${i}" value="${isPlayed ? game.homeScore : ''}" placeholder="—">
                        <span>:</span>
                        <input type="number" min="0" max="99" id="away-${i}" value="${isPlayed ? game.awayScore : ''}" placeholder="—">
                    </div>
                    <span class="status-badge ${isPlayed ? 'played-badge' : 'future'}">${isPlayed ? 'Сыграно' : 'Впереди'}</span>
                `;
                list.appendChild(row);
            });
        }

        function getUpdatedGamesArray() {
            return KGASU_GAMES.map((game, i) => {
                const homeInput = document.getElementById(`home-${i}`).value;
                const awayInput = document.getElementById(`away-${i}`).value;
                const homeScore = homeInput !== '' ? parseInt(homeInput) : null;
                const awayScore = awayInput !== '' ? parseInt(awayInput) : null;
                return { ...game, homeScore, awayScore };
            });
        }

        function generateFileContent() {
            const games = getUpdatedGamesArray();
            const gamesStr = games.map(g => {
                const hs = g.homeScore !== null ? g.homeScore : 'null';
                const as = g.awayScore !== null ? g.awayScore : 'null';
                return `    { date: '${g.date}', home: '${g.home}', away: '${g.away}', homeScore: ${hs}, awayScore: ${as} }`;
            }).join(',\n');

            return `// Расписание игр КГАСУ — Дивизион АБ ПЛХЛ 2025/2026
// Данные спарсены с plhl.ru (tournamentId=15651, teamId=1304107)
// Для обновления: заменить массив KGASU_GAMES актуальными данными

const TEAM_LOGOS = {
    'КГАСУ': 'logo.jpeg',
    'Гагарин': 'opponents/gagarin.jpg',
    'Стрела - Дион': 'opponents/strela-dion.jpg',
    'Пестрецы': 'opponents/pestrecy.jpg',
    'КАИ': 'opponents/kai.jpg',
    'Ядран - AB': 'opponents/yadran-ab.jpg',
    'Сигма': 'opponents/sigma.jpg',
    'Казанские Юлбарсы': 'opponents/yulbarsy.jpg',
    'Ак Буре': 'opponents/ak-bure.jpg',
    'Зилант': 'opponents/zilant.jpg',
    'Тимерхан': 'opponents/timerhan.jpg',
    'Армеец': 'opponents/armeec.jpg'
};

const KGASU_GAMES = [
${gamesStr}
];

// Определяем путь к изображениям (главная или подстраница)
function getImagesPath() {
    const isSubpage = window.location.pathname.includes('/pages/');
    return isSubpage ? '../images/' : 'images/';
}

// Форматирование даты: "18 февраля 2026, 20:15"
function formatGameDate(dateStr) {
    const date = new Date(dateStr);
    const months = [
        'января', 'февраля', 'марта', 'апреля', 'мая', 'июня',
        'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'
    ];
    const day = date.getDate();
    const month = months[date.getMonth()];
    const year = date.getFullYear();
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    return \`\${day} \${month} \${year}, \${hours}:\${minutes}\`;
}

// Найти ближайшую будущую игру
function getNextGame() {
    const now = new Date();
    const futureGames = KGASU_GAMES.filter(g => new Date(g.date) > now && g.homeScore === null);
    return futureGames.length > 0 ? futureGames[0] : null;
}

// Обновить блок "Следующий матч" на главной
function updateNextGameBlock() {
    const dateEl = document.querySelector('.next-game-date');
    const teamsEl = document.querySelector('.next-game-teams');
    if (!dateEl || !teamsEl) return;

    const game = getNextGame();
    if (!game) {
        dateEl.textContent = 'Сезон завершён';
        teamsEl.innerHTML = '<span class="team-name">Все матчи сыграны</span>';
        return;
    }

    const imagesPath = getImagesPath();

    dateEl.textContent = formatGameDate(game.date);

    teamsEl.innerHTML = \`
        <img src="\${imagesPath}\${TEAM_LOGOS[game.home]}" alt="\${game.home}" class="next-game-logo">
        <span class="team-name\${game.home !== 'КГАСУ' ? ' opponent' : ''}">\${game.home}</span>
        <span class="vs">VS</span>
        <span class="team-name\${game.away !== 'КГАСУ' ? ' opponent' : ''}">\${game.away}</span>
        <img src="\${imagesPath}\${TEAM_LOGOS[game.away]}" alt="\${game.away}" class="next-game-logo">
    \`;
}

// Запуск при загрузке страницы
document.addEventListener('DOMContentLoaded', updateNextGameBlock);
`;
        }

        function showToast(text) {
            const toast = document.getElementById('toast');
            toast.textContent = text;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function copyUpdatedFile() {
            const content = generateFileContent();
            navigator.clipboard.writeText(content).then(() => {
                showToast('Скопировано! Вставьте в js/schedule.js');
            }).catch(() => {
                // Fallback
                const textarea = document.createElement('textarea');
                textarea.value = content;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showToast('Скопировано! Вставьте в js/schedule.js');
            });
        }

        renderGames();
    </script>
</body>
</html>
